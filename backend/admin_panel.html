<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blaze Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white min-h-screen p-6">
    <div class="max-w-6xl mx-auto">

        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-red-500 mb-2">‚ö° BLAZE ADMIN</h1>
            <div id="status" class="text-sm text-gray-400">
                <span id="dot" class="inline-block w-2 h-2 bg-gray-500 rounded-full mr-2"></span>
                <span id="statusText">Connecting...</span>
            </div>
        </div>

        <div class="bg-gray-900 border border-red-600 rounded-lg p-4 mb-4">
            <h2 class="text-xl font-bold text-red-500 mb-3">ADD PLAYER</h2>
            <div class="grid gap-3">
                <input type="text" id="name" placeholder="Player Name" 
                    class="w-full p-2 bg-black border border-gray-700 rounded text-white">
                <input type="text" id="rfid" placeholder="RFID" 
                    class="w-full p-2 bg-black border border-gray-700 rounded text-white">
                <select id="team" class="w-full p-2 bg-black border border-gray-700 rounded text-white">
                    <option value="team1">‚ô•Ô∏è TEAM HEARTS</option>
                    <option value="team2">‚ô†Ô∏è TEAM SPADES</option>
                </select>
                <button onclick="addPlayer()" 
                    class="w-full bg-red-600 hover:bg-green-700 text-white font-bold py-2 rounded">
                    ‚ûï ADD
                </button>
            </div>
        </div>

        <div class="bg-gray-900 border border-red-600 rounded-lg p-4 mb-4">
            <h2 class="text-xl font-bold text-red-500 mb-3">CONTROLS</h2>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="startMatch()" class="bg-red-600 hover:bg-green-700 text-white font-bold py-2 rounded">
                    START
                </button>
                <button onclick="endMatch()" class="bg-red-600 hover:bg-blue-700 text-white font-bold py-2 rounded">
                    END
                </button>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4 mb-4">
            <div class="bg-gray-900 border border-red-600 rounded-lg p-4">
                <h2 class="text-xl font-bold text-red-500 mb-3">‚ô•Ô∏è HEARTS</h2>
                <div id="team1" class="space-y-2"></div>
            </div>
            <div class="bg-gray-900 border border-gray-600 rounded-lg p-4">
                <h2 class="text-xl font-bold text-gray-400 mb-3">‚ô†Ô∏è SPADES</h2>
                <div id="team2" class="space-y-2"></div>
            </div>
        </div>

        <div class="bg-gray-900 border border-green-600 rounded-lg p-4 mb-4">
            <h2 class="text-xl font-bold text-red-500 mb-3">TRACKER</h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <select id="killPlayer" class="w-full p-2 bg-black border border-gray-700 rounded text-white mb-2">
                        <option value="">Select Player</option>
                    </select>
                    <button onclick="regKill()" class="w-full bg-red-600 hover:bg-green-700 text-white font-bold py-2 rounded">
                        KILL
                    </button>
                </div>
                <div>
                    <select id="deathPlayer" class="w-full p-2 bg-black border border-gray-700 rounded text-white mb-2">
                        <option value="">Select Player</option>
                    </select>
                    <button onclick="regDeath()" class="w-full bg-red-600 hover:bg-blue-700 text-white font-bold py-2 rounded">
                        DEATH
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-gray-900 border border-red-600 rounded-lg p-4">
            <button onclick="clearAll()" class="w-full bg-red-900 hover:bg-red-950 text-white font-bold py-2 rounded">
                üóëÔ∏è CLEAR ALL PLAYERS
            </button>
        </div>
    </div>

    <div id="toast" class="fixed top-4 right-4 px-4 py-2 rounded shadow-lg hidden"></div>

    <script>
        const API = 'http://localhost:5000';
        let players = {team1: [], team2: []};

        async function load() {
            try {
                const r = await fetch(`${API}/api/players`);
                players = await r.json();
                render();
                updateDropdowns();
                setStatus(true);
            } catch(e) {
                setStatus(false);
            }
        }

        function setStatus(ok) {
            document.getElementById('dot').className = `inline-block w-2 h-2 rounded-full mr-2 ${ok ? 'bg-green-500' : 'bg-red-500'}`;
            document.getElementById('statusText').textContent = ok ? 'Connected' : 'Disconnected';
        }

        function render() {
            ['team1', 'team2'].forEach(t => {
                const el = document.getElementById(t);
                const team = players[t] || [];
                el.innerHTML = team.length ? team.map(p => `
                    <div class="bg-black border border-gray-700 rounded p-2 flex justify-between items-center">
                        <div>
                            <div class="font-bold">${p.name}</div>
                            <div class="text-xs text-gray-500">K:${p.kills} D:${p.deaths} KD:${(p.deaths?p.kills/p.deaths:p.kills).toFixed(2)}</div>
                        </div>
                        <button onclick="remove('${p.rfid}')" class="bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-sm">‚úï</button>
                    </div>
                `).join('') : '<div class="text-gray-500 text-center py-4">No players</div>';
            });
        }

        function updateDropdowns() {
            const all = [...(players.team1||[]), ...(players.team2||[])];
            const opts = '<option value="">Select</option>' + all.map(p => 
                `<option value="${p.rfid}">${p.name}</option>`
            ).join('');
            document.getElementById('killPlayer').innerHTML = opts;
            document.getElementById('deathPlayer').innerHTML = opts;
        }

        async function addPlayer() {
            const name = document.getElementById('name').value.trim();
            const rfid = document.getElementById('rfid').value.trim() || `M${Date.now()}`;
            const team = document.getElementById('team').value;
            if (!name) return toast('Enter name!', 'error');
            
            try {
                await fetch(`${API}/api/register`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({rfid, name, team})
                });
                toast(`${name} added!`, 'ok');
                document.getElementById('name').value = '';
                document.getElementById('rfid').value = '';
                load();
            } catch(e) {
                toast('Error!', 'error');
            }
        }

        async function regKill() {
            const rfid = document.getElementById('killPlayer').value;
            if (!rfid) return toast('Select player!', 'error');
            try {
                await fetch(`${API}/api/kill`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({rfid})
                });
                toast('Kill registered!', 'ok');
                load();
            } catch(e) {
                toast('Error!', 'error');
            }
        }

        async function regDeath() {
            const rfid = document.getElementById('deathPlayer').value;
            if (!rfid) return toast('Select player!', 'error');
            try {
                await fetch(`${API}/api/death`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({rfid})
                });
                toast('Death registered!', 'ok');
                load();
            } catch(e) {
                toast('Error!', 'error');
            }
        }

        function startMatch() {
            toast('Match started!', 'ok');
        }

        async function endMatch() {
            if (!confirm('End match?')) return;
            try {
                await fetch(`${API}/api/end_match`, {method: 'POST'});
                toast('Match ended!', 'ok');
            } catch(e) {
                toast('Error!', 'error');
            }
        }

        async function clearAll() {
            if (!confirm('Clear ALL players?')) return;
            try {
                await fetch(`${API}/api/clear_team`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({team: 'team1'})
                });
                await fetch(`${API}/api/clear_team`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({team: 'team2'})
                });
                toast('All cleared!', 'ok');
                load();
            } catch(e) {
                toast('Error!', 'error');
            }
        }

        async function remove(rfid) {
            if (!confirm('Remove?')) return;
            try {
                await fetch(`${API}/api/remove_player`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({rfid})
                });
                toast('Removed!', 'ok');
                load();
            } catch(e) {
                toast('Error!', 'error');
            }
        }

        function toast(msg, type) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = `fixed top-4 right-4 px-4 py-2 rounded shadow-lg ${
                type === 'ok' ? 'bg-green-600' : 'bg-red-600'
            } text-white`;
            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 2000);
        }

        load();
        setInterval(load, 3000);
    </script>
</body>
</html>